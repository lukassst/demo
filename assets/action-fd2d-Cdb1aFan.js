import{l as v,c as F,u as C,p as y}from"./index-CUQMCrQX.js";import{f as D}from"./fractal-BujRWoy0.js";const w={handleFd2d(n,a){n.style.display="none";const t=this.createFd2dInputs();t.querySelector("#fd2d-calculate").addEventListener("click",()=>{this.executeFd2dCalculation()}),a.appendChild(t)},async executeFd2dCalculation(){const n=document.getElementById("fd-dim").value,a=document.getElementById("fd-size").value,t=document.getElementById("fd-win-1").value,m=document.getElementById("fd-win-2").value,i=document.getElementById("fd-scales-1").value.trim(),r=document.getElementById("fd-scales-2").value.trim(),s=document.getElementById("fd-method-1").value,l=document.getElementById("fd-method-2").value,c=y(i),o=y(r);if(c===null||o===null){alert("Please enter valid scale values (e.g., 1,2,3,4)");return}const e={dim:parseFloat(n),size:parseInt(a),window1:parseInt(t),window2:parseInt(m),method1:parseInt(s),method2:parseInt(l),scales1:c,scales2:o};console.log("FD 2D Parameters:",e);const p=await D(e.dim,e.size,e.window1,e.window2,e.scales1,e.scales2,e.method1,e.method2),d=document.getElementById("viewer-grid");d.innerHTML="",d.style.display="grid",d.style.gridTemplateColumns="repeat(2, 1fr)",d.style.gridTemplateRows="auto auto auto auto auto",d.style.gap="6px",d.style.height="100%",d.style.padding="0px",d.style.overflowY="auto",d.style.overflowX="auto",d.style.alignContent="start",d.style.alignItems="stretch";const h=this.createFd2dContainers();h.forEach(f=>d.appendChild(f)),await this.createFd2dPlots(h,p,e)},createFd2dInputs(){const n=document.createElement("div");n.className="fd2d-inputs";const a="display: flex; gap: 10px; margin-bottom: 10px;",t="flex: 1; min-width: 0;";[[{name:"Dim",type:"number",value:"2.5",id:"fd-dim"},{name:"Size",type:"number",value:"256",id:"fd-size"}],[{name:"Window 1",type:"number",value:"7",id:"fd-win-1"},{name:"Window 2",type:"number",value:"7",id:"fd-win-2"}],[{name:"Scales 1",type:"text",value:"1,2,3",id:"fd-scales-1"},{name:"Scales 2",type:"text",value:"1,2,3",id:"fd-scales-2"}],[{name:"Method 1",type:"number",value:"0",id:"fd-method-1"},{name:"Method 2",type:"number",value:"0",id:"fd-method-2"}]].forEach(r=>{const s=document.createElement("div");s.style.cssText=a,r.forEach(l=>{const c=document.createElement("div");c.className="input-group",c.style.cssText=t;const o=document.createElement("label");o.textContent=l.name+":",o.style.display="block",o.style.marginBottom="3px",o.style.fontSize="12px";const e=document.createElement("input");e.type=l.type,e.value=l.value,e.id=l.id||"fd-"+l.name.replace(/\s+/g,"-").toLowerCase(),e.style.width="100%",e.style.padding="6px",e.style.fontSize="12px",e.style.borderRadius="4px",e.style.border="1px solid #ccc",c.appendChild(o),c.appendChild(e),s.appendChild(c)}),n.appendChild(s)});const i=C.createActionButton("Calculate","fd2d-calculate");return n.appendChild(i),n},async createFd2dPlots(n,a,t){await v();const[m,i,r,s,l,c,o,e,p,d]=n,{originalImageMatrix:h,fd1Matrix:f,fd2Matrix:u}=this.convertResultsToMatrices(a,t.size),g=this.getCommonHeatmapOptions(t.size),x=[[0,"rgb(255, 255, 0)"],[1,"rgb(0, 0, 255)"]];this.createOriginalImagePlots(m,i,h,t.dim,g),this.createFractalDimensionPlots(r,s,f,u,t,g,x),this.createHistogramPlots(l,c,a),this.createDifferencePlots(o,e,a,t.size,g),F(p,d,{fd1Values:Array.from(a.fractalDimension1),fd2Values:Array.from(a.fractalDimension2)})},createFd2dContainers(){return[{className:"plot-container",height:"300px"},{className:"plot-container",height:"300px"},{className:"plot-container",height:"300px"},{className:"plot-container",height:"300px"},{className:"plot-container",height:"250px"},{className:"plot-container",height:"250px"},{className:"plot-container",height:"300px"},{className:"plot-container",height:"250px"},{className:"plot-container stats-container",height:"auto",padding:"8px"},{className:"plot-container stats-container",height:"auto",padding:"8px"}].map(a=>{const t=document.createElement("div");return t.className=a.className,t.style.width="100%",t.style.height=a.height,t.style.textAlign="left",t.style.marginBottom="0",a.padding&&(t.style.padding=a.padding),t})},convertResultsToMatrices(n,a){const t=[],m=[],i=[];for(let r=0;r<a;r++){const s=[],l=[],c=[];for(let o=0;o<a;o++){const e=r*a+o;s.push(n.originalImage[e]),l.push(n.fractalDimension1[e]),c.push(n.fractalDimension2[e])}t.push(s),m.push(l),i.push(c)}return{originalImageMatrix:t,fd1Matrix:m,fd2Matrix:i}},getCommonHeatmapOptions(n){return{autosize:!1,width:400,height:300,margin:{t:40,b:5,l:5,r:5},xaxis:{showticklabels:!1,ticks:"",showgrid:!1,zeroline:!1,range:[0,n]},yaxis:{showticklabels:!1,ticks:"",showgrid:!1,zeroline:!1,scaleanchor:"x",scaleratio:1,range:[0,n]}}},createOriginalImagePlots(n,a,t,m,i){const r=[{z:t,type:"heatmap",colorscale:"Greys",showscale:!0,zmin:0,zmax:255,colorbar:{title:"Intensity",len:1,y:.5,yanchor:"middle",tickvals:[0,128,255],ticktext:["0","128","255"]}}];Plotly.newPlot(n,r,{...i,title:`Original Image (D=${m})`},{responsive:!0}),Plotly.newPlot(a,r,{...i,title:"Original Image (Grayscale)"},{responsive:!0})},createFractalDimensionPlots(n,a,t,m,i,r,s){const l={type:"heatmap",colorscale:s,showscale:!0,zmin:2,zmax:3,colorbar:{title:"FD",len:1,tickvals:[2,2.25,2.5,2.75,3],ticktext:["2.0","2.25","2.5","2.75","3.0"],y:.5,yanchor:"middle"}};Plotly.newPlot(n,[{...l,z:t}],{...r,title:`Fractal Dimension 1 (Win=${i.window1}, Scales=${i.scales1.length})`},{responsive:!0}),Plotly.newPlot(a,[{...l,z:m}],{...r,title:`Fractal Dimension 2 (Win=${i.window2}, Scales=${i.scales2.length})`},{responsive:!0})},createHistogramPlots(n,a,t){const i=Array.from(t.fractalDimension1).filter(o=>o>=2&&o<=3),s=Array.from(t.fractalDimension2).filter(o=>o>=2&&o<=3),l={margin:{t:40,b:30,l:10,r:10},xaxis:{title:"Fractal Dimension",range:[2,3],showgrid:!1},yaxis:{showticklabels:!1,title:"",showgrid:!1,zeroline:!1}},c={type:"histogram",nbinsx:50,marker:{color:"rgba(100, 100, 255, 0.7)",line:{color:"rgba(0, 0, 200, 1)",width:1}}};Plotly.newPlot(n,[{...c,x:i}],{...l,title:`FD1 Histogram (Mean: ${(i.reduce((o,e)=>o+e,0)/i.length).toFixed(3)})`},{responsive:!0}),Plotly.newPlot(a,[{...c,x:s}],{...l,title:`FD2 Histogram (Mean: ${(s.reduce((o,e)=>o+e,0)/s.length).toFixed(3)})`},{responsive:!0})},createDifferencePlots(n,a,t,m,i){const r=[],s=[];for(let e=0;e<m;e++){const p=[];for(let d=0;d<m;d++){const h=e*m+d,f=t.fractalDimension1[h]-t.fractalDimension2[h];p.push(f);const u=(Math.random()*2-1)*1e-6;s.push(f+u)}r.push(p)}Plotly.newPlot(n,[{z:r,type:"heatmap",colorscale:[[0,"rgb(0, 0, 255)"],[.5,"rgb(255, 255, 255)"],[1,"rgb(255, 0, 0)"]],showscale:!0,zmin:-1,zmax:1,colorbar:{title:"FD Difference",tickvals:[-1,-.75,-.5,-.25,0,.25,.5,.75,1],ticktext:["-1.0","-0.75","-0.5","-0.25","0","0.25","0.5","0.75","1.0"],len:1,y:.5,yanchor:"middle"}}],{...i,title:"Fractal Dimension Difference (FD1 - FD2)"},{responsive:!0});const l=s.reduce((e,p)=>e+p,0)/s.length,c=s.reduce((e,p)=>e+Math.pow(p-l,2),0)/s.length,o=Math.sqrt(c);Plotly.newPlot(a,[{x:s,type:"histogram",nbinsx:50,marker:{color:"rgba(100, 100, 255, 0.7)",line:{color:"rgba(100, 100, 255, 1)",width:1}}}],{title:`FD Difference Histogram (Mean: ${l.toFixed(6)}, StDev: ${o.toFixed(6)})`,margin:{t:40,b:40,l:10,r:10},xaxis:{title:"FD1 - FD2",range:[-1,1],showgrid:!1},yaxis:{showticklabels:!1,title:"",showgrid:!1,zeroline:!1}},{responsive:!0})}},I=w.handleFd2d.bind(w);export{I as handleFd2d};
