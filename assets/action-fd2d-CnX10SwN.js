import{l as b,c as D,u as F,p as x}from"./index-CVwNq2Ey.js";import{f as P}from"./fractal-D3i6GnW3.js";const C={handleFd2d(t,s){t.style.display="none";const i=this.createFd2dInputs();i.querySelector("#fd2d-calculate").addEventListener("click",()=>{this.executeFd2dCalculation()}),s.appendChild(i)},async executeFd2dCalculation(){const t=document.getElementById("fd-dim").value,s=document.getElementById("fd-size").value,i=document.getElementById("fd-win-1").value,l=document.getElementById("fd-win-2").value,r=document.getElementById("fd-scales-1").value.trim(),a=document.getElementById("fd-scales-2").value.trim(),n=document.getElementById("fd-method-1").value,d=document.getElementById("fd-method-2").value,c=x(r),o=x(a);if(c===null||o===null){alert("Please enter valid scale values (e.g., 1,2,3,4)");return}const e={dim:parseFloat(t),size:parseInt(s),window1:parseInt(i),window2:parseInt(l),method1:parseInt(n),method2:parseInt(d),scales1:c,scales2:o};console.log("FD 2D Parameters:",e);const g=await P(e.dim,e.size,e.window1,e.window2,e.scales1,e.scales2,e.method1,e.method2),m=document.getElementById("viewer-grid");m.innerHTML="",m.style.display="block",m.style.height="calc(100vh - 100px)",m.style.width="100%",m.style.overflowY="auto",m.style.padding="15px",m.style.boxSizing="border-box";const{gridContainer:p,containers:f}=this.createFd2dContainers();m.appendChild(p),await this.createFd2dPlots(f,g,e)},createFd2dInputs(){const t=document.createElement("div");t.className="fd2d-inputs";const s="display: flex; gap: 10px; margin-bottom: 10px;",i="flex: 1; min-width: 0;";[[{name:"Dim",type:"number",value:"2.5",id:"fd-dim"},{name:"Size",type:"number",value:"256",id:"fd-size"}],[{name:"Window 1",type:"number",value:"7",id:"fd-win-1"},{name:"Window 2",type:"number",value:"7",id:"fd-win-2"}],[{name:"Scales 1",type:"text",value:"1,2,3",id:"fd-scales-1"},{name:"Scales 2",type:"text",value:"1,2,3",id:"fd-scales-2"}],[{name:"Method 1",type:"number",value:"0",id:"fd-method-1"},{name:"Method 2",type:"number",value:"0",id:"fd-method-2"}]].forEach(a=>{const n=document.createElement("div");n.style.cssText=s,a.forEach(d=>{const c=document.createElement("div");c.className="input-group",c.style.cssText=i;const o=document.createElement("label");o.textContent=d.name+":",o.style.display="block",o.style.marginBottom="3px",o.style.fontSize="12px";const e=document.createElement("input");e.type=d.type,e.value=d.value,e.id=d.id||"fd-"+d.name.replace(/\s+/g,"-").toLowerCase(),e.style.width="100%",e.style.padding="6px",e.style.fontSize="12px",e.style.borderRadius="4px",e.style.border="1px solid #ccc",c.appendChild(o),c.appendChild(e),n.appendChild(c)}),t.appendChild(n)});const r=F.createActionButton("Calculate","fd2d-calculate");return t.appendChild(r),t},async createFd2dPlots(t,s,i){await b();const[l,r,a,n,d,c,o,e,g,m]=t,{originalImageMatrix:p,fd1Matrix:f,fd2Matrix:u}=this.convertResultsToMatrices(s,i.size),h=this.getCommonHeatmapOptions(i.size),v=[[0,"rgb(255, 255, 0)"],[1,"rgb(0, 0, 255)"]];this.createOriginalImagePlots(l,r,p,i.dim,h),this.createFractalDimensionPlots(a,n,f,u,i,h,v),this.createHistogramPlots(d,c,s),this.createDifferencePlots(o,e,s,i.size,h);const y=document.getElementById("fd2d-stats1"),w=document.getElementById("fd2d-stats2");y&&w&&D(y,w,{fd1Values:Array.from(s.fractalDimension1),fd2Values:Array.from(s.fractalDimension2)})},createFd2dContainers(){const t=document.createElement("div");t.style.display="grid",t.style.gridTemplateColumns="repeat(2, 1fr)",t.style.gridTemplateRows="auto auto auto auto auto",t.style.gap="20px",t.style.width="100%",t.style.minHeight="100%",t.style.overflow="visible";const i=[{className:"plot-container original-image",style:{height:"300px",gridColumn:"1 / 2",gridRow:"1 / 2"}},{className:"plot-container original-image",style:{height:"300px",gridColumn:"2 / 3",gridRow:"1 / 2"}},{className:"plot-container fractal-plot",style:{height:"300px",gridColumn:"1 / 2",gridRow:"2 / 3"}},{className:"plot-container fractal-plot",style:{height:"300px",gridColumn:"2 / 3",gridRow:"2 / 3"}},{className:"plot-container histogram",style:{height:"300px",gridColumn:"1 / 2",gridRow:"3 / 4",display:"flex",flexDirection:"column",justifyContent:"center"}},{className:"plot-container histogram",style:{height:"300px",gridColumn:"2 / 3",gridRow:"3 / 4",display:"flex",flexDirection:"column",justifyContent:"center"}},{className:"plot-container diff-heatmap",style:{height:"300px",gridColumn:"1 / 2",gridRow:"4 / 5"}},{className:"plot-container diff-histogram",style:{height:"300px",gridColumn:"2 / 3",gridRow:"4 / 5",display:"flex",flexDirection:"column",justifyContent:"center"}},{className:"plot-container stats-container",style:{height:"auto",padding:"8px",gridColumn:"1 / 2",gridRow:"5 / 6",width:"100%",boxSizing:"border-box"},isStatsContainer:!0,statsId:"fd2d-stats1"},{className:"plot-container stats-container",style:{height:"auto",padding:"8px",gridColumn:"2 / 3",gridRow:"5 / 6",width:"100%",boxSizing:"border-box"},isStatsContainer:!0,statsId:"fd2d-stats2"}].map((l,r)=>{const a=document.createElement("div");if(a.className=l.className,a.style.width="100%",a.style.minHeight=l.style.height||"200px",a.style.maxHeight="100%",a.style.textAlign="left",a.style.overflow="visible",Object.assign(a.style,l.style),l.isStatsContainer){const n=document.createElement("div");n.id=l.statsId,n.style.width="100%",n.style.height="100%",a.appendChild(n)}return t.appendChild(a),a});return{gridContainer:t,containers:i}},convertResultsToMatrices(t,s){const i=[],l=[],r=[];for(let a=0;a<s;a++){const n=[],d=[],c=[];for(let o=0;o<s;o++){const e=a*s+o;n.push(t.originalImage[e]),d.push(t.fractalDimension1[e]),c.push(t.fractalDimension2[e])}i.push(n),l.push(d),r.push(c)}return{originalImageMatrix:i,fd1Matrix:l,fd2Matrix:r}},getCommonHeatmapOptions(t){return{autosize:!1,width:400,height:300,margin:{t:40,b:5,l:5,r:5},xaxis:{showticklabels:!1,ticks:"",showgrid:!1,zeroline:!1,range:[0,t]},yaxis:{showticklabels:!1,ticks:"",showgrid:!1,zeroline:!1,scaleanchor:"x",scaleratio:1,range:[0,t]}}},createOriginalImagePlots(t,s,i,l,r){const a=[{z:i,type:"heatmap",colorscale:"Greys",showscale:!0,zmin:0,zmax:255,colorbar:{title:"Intensity",len:1,y:.5,yanchor:"middle",tickvals:[0,128,255],ticktext:["0","128","255"]}}];Plotly.newPlot(t,a,{...r,title:`Original Image (D=${l})`},{responsive:!0}),Plotly.newPlot(s,a,{...r,title:"Original Image (Grayscale)"},{responsive:!0})},createFractalDimensionPlots(t,s,i,l,r,a,n){const d={type:"heatmap",colorscale:n,showscale:!0,zmin:2,zmax:3,colorbar:{title:"FD",len:1,tickvals:[2,2.25,2.5,2.75,3],ticktext:["2.0","2.25","2.5","2.75","3.0"],y:.5,yanchor:"middle"}};Plotly.newPlot(t,[{...d,z:i}],{...a,title:`Fractal Dimension 1 (Win=${r.window1}, Scales=${r.scales1.length})`},{responsive:!0}),Plotly.newPlot(s,[{...d,z:l}],{...a,title:`Fractal Dimension 2 (Win=${r.window2}, Scales=${r.scales2.length})`},{responsive:!0})},createHistogramPlots(t,s,i){const r=Array.from(i.fractalDimension1).filter(o=>o>=2&&o<=3),n=Array.from(i.fractalDimension2).filter(o=>o>=2&&o<=3),d={margin:{t:40,b:30,l:10,r:10},xaxis:{title:"Fractal Dimension",range:[2,3],showgrid:!1},yaxis:{showticklabels:!1,title:"",showgrid:!1,zeroline:!1}},c={type:"histogram",nbinsx:50,marker:{color:"rgba(100, 100, 255, 0.7)",line:{color:"rgba(0, 0, 200, 1)",width:1}}};Plotly.newPlot(t,[{...c,x:r}],{...d,title:`FD1 Histogram (Mean: ${(r.reduce((o,e)=>o+e,0)/r.length).toFixed(3)})`},{responsive:!0}),Plotly.newPlot(s,[{...c,x:n}],{...d,title:`FD2 Histogram (Mean: ${(n.reduce((o,e)=>o+e,0)/n.length).toFixed(3)})`},{responsive:!0})},createDifferencePlots(t,s,i,l,r){const a=[],n=[];for(let e=0;e<l;e++){const g=[];for(let m=0;m<l;m++){const p=e*l+m,f=i.fractalDimension1[p]-i.fractalDimension2[p];g.push(f);const u=(Math.random()*2-1)*1e-6;n.push(f+u)}a.push(g)}Plotly.newPlot(t,[{z:a,type:"heatmap",colorscale:[[0,"rgb(0, 0, 255)"],[.5,"rgb(255, 255, 255)"],[1,"rgb(255, 0, 0)"]],showscale:!0,zmin:-1,zmax:1,colorbar:{title:"FD Difference",tickvals:[-1,-.75,-.5,-.25,0,.25,.5,.75,1],ticktext:["-1.0","-0.75","-0.5","-0.25","0","0.25","0.5","0.75","1.0"],len:1,y:.5,yanchor:"middle"}}],{...r,title:"Fractal Dimension Difference (FD1 - FD2)"},{responsive:!0});const d=n.reduce((e,g)=>e+g,0)/n.length,c=n.reduce((e,g)=>e+Math.pow(g-d,2),0)/n.length,o=Math.sqrt(c);Plotly.newPlot(s,[{x:n,type:"histogram",nbinsx:50,marker:{color:"rgba(100, 100, 255, 0.7)",line:{color:"rgba(100, 100, 255, 1)",width:1}}}],{title:`FD Difference Histogram (Mean: ${d.toFixed(6)}, StDev: ${o.toFixed(6)})`,margin:{t:40,b:40,l:10,r:10},xaxis:{title:"FD1 - FD2",range:[-1,1],showgrid:!1},yaxis:{showticklabels:!1,title:"",showgrid:!1,zeroline:!1}},{responsive:!0})}},z=C.handleFd2d.bind(C);export{z as handleFd2d};
